---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/common/Header.astro';
import Footer from '../../components/common/Footer.astro';
import CTASection from '../../components/common/CTASection.astro';
import InsightCard from '../../components/common/InsightCard.astro';
import ReelsCard from '../../components/common/ReelsCard.astro';
import { getInsights, getImageUrl } from '../../lib/strapi';

// Format date to Indonesian
const formatDate = (dateString) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('id-ID', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
  });
};

// Fetch insights from Strapi
let latestArticles = [];
let allArticles = [];

try {
  const response = await getInsights({ 'pagination[limit]': 12 });
  const insights = response.data?.map((insight) => ({
    title: insight.attributes.title,
    author: insight.attributes.author?.data?.attributes?.name || 'SJD Interior Team',
    authorPhoto: getImageUrl(insight.attributes.author?.data?.attributes?.photo, 'thumbnail'),
    date: formatDate(insight.attributes.publishedAt || insight.attributes.createdAt),
    category: insight.attributes.category.toUpperCase(),
    image: getImageUrl(insight.attributes.featured_image, 'medium') || '/images/insight-card.jpg',
    slug: insight.attributes.slug,
    featured: insight.attributes.is_featured || false
  })) || [];

  // Get featured/latest for top section
  latestArticles = insights.slice(0, 3);
  
  // Get all for grid section
  allArticles = insights;

} catch (error) {
  console.error('Error fetching insights:', error);
  // Fallback to mock data if Strapi fails
  latestArticles = [
    {
      title: "8 Konsep Desain Interior yang Akan Tren di 2026",
      author: "Nurhanif Kamal Putra",
      date: "8 Januari 2026",
      category: "NEWS",
      image: "/images/insight-card.jpg",
      slug: "8-konsep-desain-interior-2026",
      featured: true
    },
    {
      title: "Panduan Memilih Warna untuk Ruang Tamu Modern",
      author: "Rina Wijaya",
      date: "5 Januari 2026",
      category: "TIPS",
      image: "/images/insight-card.jpg",
      slug: "panduan-warna-ruang-tamu",
      featured: false
    },
    {
      title: "Tren Material Sustainable dalam Interior Design",
      author: "Budi Santoso",
      date: "2 Januari 2026",
      category: "TREND",
      image: "/images/insight-card.jpg",
      slug: "tren-material-sustainable",
      featured: false
    }
  ];
  
  allArticles = Array(9).fill(null).map(() => latestArticles[0]);
}
---

<BaseLayout
  title="Insight - SJD Interior"
  description="Artikel dan tips seputar desain interior dari SJD Interior"
>
  <Header />

  <main class="bg-white">
    <!-- Hero Section -->
    <!-- Hero Section -->
    <section class="relative pt-32 md:pt-40 lg:pt-52 pb-12 md:pb-16 lg:pb-24 bg-white">
      <div class="w-full max-w-[1761px] mx-auto px-6 md:px-12 lg:px-[151px]">
        <h1 class="text-[48px] md:text-[88px] lg:text-[128px] font-light text-black mb-4 md:mb-6 lg:mb-8" style="letter-spacing: -2.4px; line-height: 98.83%;">
          Insight hari ini.
        </h1>
        <p class="text-[24px] md:text-[36px] lg:text-[48px] font-light text-[#929292] leading-[1.2] max-w-5xl" style="letter-spacing: -1px;">
          Tips, tren, dan inspirasi desain interior terkini
        </p>
      </div>
    </section>

    <!-- Instagram Reels Section -->
    <section class="py-4 md:py-8 lg:py-12 bg-white overflow-hidden">
      <div class="w-full max-w-[1761px] mx-auto px-6 md:px-12 lg:px-[151px]">
        <div class="flex items-end justify-between mb-8 md:mb-12">
          <div>
            <h2 class="text-[28px] md:text-[40px] font-light mb-2 text-black" style="letter-spacing: -1px;">Instagram Reels</h2>
            <p class="text-[#666] text-[16px]">Follow our journey @sjd_interior</p>
          </div>
          <a href="https://www.instagram.com/sjd_interior" target="_blank" class="hidden md:inline-flex px-6 py-2 rounded-full border border-black/20 hover:bg-black hover:text-white hover:border-black transition-all text-sm font-medium text-black">
            Lihat Instagram
          </a>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
          <ReelsCard 
            caption="Transformasi ruang tamu minimalis modern. Swipe for before/after! âœ¨ #interiordesign" 
            views="45.2K" 
            thumbnail="/images/insight-card.jpg" 
            url="https://www.instagram.com/sjd_interior"
          />
          <ReelsCard 
            caption="Proses pemasangan custom furniture di project Bintaro. Precision is key. ðŸ“" 
            views="32.1K" 
            thumbnail="/images/insight-card.jpg" 
            url="https://www.instagram.com/sjd_interior"
          />
          <ReelsCard 
            caption="Master bedroom vibes. Warm lighting + texture = perfection. ðŸ›ï¸" 
            views="68.9K" 
            thumbnail="/images/insight-card.jpg" 
            url="https://www.instagram.com/sjd_interior"
          />
          <ReelsCard 
            caption="Tips memilih material lantai untuk rumah tropis. Save for later! ðŸ’¡" 
            views="18.5K" 
            thumbnail="/images/insight-card.jpg" 
            url="https://www.instagram.com/sjd_interior"
          />
        </div>

        <div class="mt-8 text-center md:hidden">
          <a href="https://www.instagram.com/sjd_interior" target="_blank" class="inline-flex px-6 py-2.5 rounded-full border border-black/20 hover:bg-black hover:text-white hover:border-black transition-all text-sm font-medium text-black">
             Lihat Instagram
          </a>
        </div>
      </div>
    </section>

    <!-- Search & Filter Section -->
    <section class="py-6 md:py-7 lg:py-8 bg-[#f9f9f9] border-y border-[#e5e5e5]">
      <div class="w-full max-w-[1761px] mx-auto px-6 md:px-12 lg:px-[151px]">
        <!-- Search Bar -->
        <div class="max-w-2xl mb-4 md:mb-5">
          <div class="relative">
            <svg class="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 w-4 h-4 md:w-5 md:h-5 text-[#636363]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35"/>
            </svg>
            <input
              type="search"
              placeholder="Cari artikel..."
              class="w-full pl-10 md:pl-12 pr-4 md:pr-6 py-2.5 md:py-3 text-[13px] md:text-[14px] font-light text-[#636363] bg-white border border-[#d9d9d9] rounded-[10px] focus:outline-none focus:border-[#0096f7] placeholder:text-[#848484]"
            />
          </div>
        </div>

        <!-- Category Filter -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 md:gap-4">
          <!-- Category Filter -->
          <div class="flex gap-2 flex-wrap" id="category-filters">
            <button class="filter-btn active px-3 md:px-4 py-1.5 md:py-2 bg-black text-white text-[12px] md:text-[13px] font-medium rounded-full hover:bg-[#333333] transition-colors" data-category="ALL">
              Semua
            </button>
            <button class="filter-btn px-3 md:px-4 py-1.5 md:py-2 bg-white text-black text-[12px] md:text-[13px] font-medium border border-[#d9d9d9] rounded-full hover:border-black transition-colors" data-category="TIPS">
              Tips
            </button>
            <button class="filter-btn px-3 md:px-4 py-1.5 md:py-2 bg-white text-black text-[12px] md:text-[13px] font-medium border border-[#d9d9d9] rounded-full hover:border-black transition-colors" data-category="TREND">
              Trend
            </button>
            <button class="filter-btn px-3 md:px-4 py-1.5 md:py-2 bg-white text-black text-[12px] md:text-[13px] font-medium border border-[#d9d9d9] rounded-full hover:border-black transition-colors" data-category="NEWS">
              News
            </button>
            <button class="filter-btn px-3 md:px-4 py-1.5 md:py-2 bg-white text-black text-[12px] md:text-[13px] font-medium border border-[#d9d9d9] rounded-full hover:border-black transition-colors" data-category="TUTORIAL">
              Tutorial
            </button>
          </div>

          <!-- Sort Filter -->
          <div class="flex items-center gap-2 md:gap-3">
            <label for="sort-select" class="text-[13px] md:text-[14px] font-light text-[#636363]">Urutkan:</label>
            <div class="relative">
              <select id="sort-select" class="appearance-none pl-3 md:pl-4 pr-8 md:pr-10 py-1.5 md:py-2 bg-white border border-[#d9d9d9] rounded-full text-[12px] md:text-[13px] font-medium text-black focus:outline-none focus:border-black cursor-pointer">
                <option value="latest">Terbaru</option>
                <option value="oldest">Terlama</option>
              </select>
              <svg class="absolute right-2 md:right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 md:w-4 md:h-4 text-black pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- All Articles Grid -->
    <section class="py-10 md:py-11 lg:py-12">
      <div class="w-full max-w-[1761px] mx-auto px-4 md:px-12 lg:px-[151px]">
        <h2 class="text-[22px] md:text-[25px] lg:text-[28px] font-light text-black mb-5 md:mb-6" style="letter-spacing: -1.10px; md:letter-spacing: -1.25px; lg:letter-spacing: -1.40px;">
          Semua Artikel
        </h2>

        <div id="articles-grid" class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-5 lg:gap-6 mb-8 md:mb-9 lg:mb-10">
          {allArticles.map((article) => (
            <div class="article-item" data-category={article.category} data-date={new Date(article.date).getTime()} data-title={article.title.toLowerCase()}>
              <InsightCard {...article} />
            </div>
          ))}
        </div>

        <!-- Pagination -->
        <div class="flex justify-center items-center gap-4 md:gap-6">
          <div class="flex gap-1.5 md:gap-2">
            {[1, 2, 3, 4, 5, 6].map((page, index) => (
              <button
                class={`w-[8px] h-[8px] md:w-[10px] md:h-[10px] rounded-full transition-colors ${index === 0 ? 'bg-black' : 'bg-[#d9d9d9] hover:bg-[#b0b0b0]'}`}
                aria-label={`Page ${page}`}
              />
            ))}
          </div>
          <button class="px-5 md:px-6 py-1.5 md:py-2 text-[13px] md:text-[14px] font-medium text-black border-2 border-black rounded-full hover:bg-black hover:text-white transition-all duration-300">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <CTASection />
  </main>

  <Footer />
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const grid = document.getElementById('articles-grid');
    const articles = Array.from(document.querySelectorAll('.article-item'));
    const sortSelect = document.getElementById('sort-select') as HTMLSelectElement;
    const filterBtns = document.querySelectorAll('.filter-btn');
    const searchInput = document.querySelector('input[type="search"]') as HTMLInputElement;

    let currentCategory = 'ALL';
    let currentSort = 'latest';
    let searchQuery = '';

    // Sort Function
    const sortArticles = () => {
      const sortedArticles = articles.sort((a, b) => {
        const dateA = parseInt((a as HTMLElement).dataset.date || '0');
        const dateB = parseInt((b as HTMLElement).dataset.date || '0');
        
        return currentSort === 'latest' ? dateB - dateA : dateA - dateB;
      });

      // Re-append sorted articles
      sortedArticles.forEach(article => grid?.appendChild(article));
    };

    // Filter Function
    const filterArticles = () => {
      articles.forEach(article => {
        const articleEl = article as HTMLElement;
        const category = articleEl.dataset.category || '';
        const title = articleEl.dataset.title || '';
        
        const matchesCategory = currentCategory === 'ALL' || category === currentCategory;
        const matchesSearch = title.includes(searchQuery.toLowerCase());

        if (matchesCategory && matchesSearch) {
          articleEl.style.display = 'block';
        } else {
          articleEl.style.display = 'none';
        }
      });
    };

    // Event Listeners
    sortSelect?.addEventListener('change', (e) => {
      currentSort = (e.target as HTMLSelectElement).value;
      sortArticles();
    });

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active class
        filterBtns.forEach(b => {
          b.classList.remove('bg-black', 'text-white');
          b.classList.add('bg-white', 'text-black', 'border', 'border-[#d9d9d9]');
        });
        btn.classList.remove('bg-white', 'text-black', 'border', 'border-[#d9d9d9]');
        btn.classList.add('bg-black', 'text-white');

        currentCategory = (btn as HTMLElement).dataset.category || 'ALL';
        filterArticles();
      });
    });

    searchInput?.addEventListener('input', (e) => {
      searchQuery = (e.target as HTMLInputElement).value;
      filterArticles();
    });

    // Initial Sort
    sortArticles();
  });
</script>
