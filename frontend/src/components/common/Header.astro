---
import Button from './Button.astro';
import { getSiteSettings } from '../../lib/getSiteSettings.js';

// Fetch site settings for logo
const siteSettings = await getSiteSettings();

// Navigation items - matching Figma design
const navItems = [
  { label: 'Beranda', href: '/' },
  { label: 'Alur Kerja', href: '/alur-kerja' },
  { label: 'Portofolio', href: '/portfolio' },
  { label: 'Insight', href: '/insight' },
  { label: 'Hubungi Kami', href: '/hubungi-kami' },
];

const currentPath = Astro.url.pathname;
---

<header
  id="main-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-transparent text-white"
>
  <div class="w-full max-w-[1761px] mx-auto px-[42px]">
    <div class="flex items-center justify-between h-[110px]">
      <!-- Logo - matching Figma -->
      <a
        href="/"
        class="hover:opacity-80 transition-opacity header-logo-link relative"
      >
        {(siteSettings.logo || siteSettings.logoLight) ? (
          <>
            {/* Dark logo - shown on white/scrolled header */}
            {siteSettings.logo && (
              <img
                src={siteSettings.logo.url}
                alt={siteSettings.logo.alt}
                class="h-12 md:h-16 w-auto object-contain logo-dark absolute top-0 left-0"
                loading="eager"
              />
            )}
            {/* Light logo - shown on transparent/hero header */}
            {siteSettings.logoLight && (
              <img
                src={siteSettings.logoLight.url}
                alt={siteSettings.logoLight.alt}
                class="h-12 md:h-16 w-auto object-contain logo-light"
                loading="eager"
              />
            )}
          </>
        ) : (
          <span class="text-[24px] md:text-[28px] font-normal leading-tight">
            <span class="block">SJD</span>
            <span class="block">Interior</span>
          </span>
        )}
      </a>

      <!-- Desktop Navigation - matching Figma -->
      <nav class="hidden lg:flex items-center gap-[19px]">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'text-[15px] font-normal hover:opacity-70 transition-opacity header-link',
              currentPath === item.href ? 'opacity-70' : ''
            ]}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <!-- CTA Button (Desktop) - matching Figma -->
      <div class="hidden lg:block">
        <a
          href="https://wa.me/6285398989810?text=Halo%20SJD%20Interior%2C%20saya%20ingin%20berkonsultasi%20tentang%20proyek%20interior%20saya."
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center w-[136px] h-[45px] text-[15px] font-medium bg-[#0096f7] text-white rounded-[22.5px] hover:bg-[#0085e0] transition-colors header-cta-btn"
        >
          Konsultasi
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="lg:hidden p-2 hover:text-primary transition-colors header-menu-btn"
        aria-label="Toggle mobile menu"
      >
        <svg class="w-6 h-6" id="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg class="w-6 h-6 hidden" id="close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <nav
    id="mobile-menu"
    class="lg:hidden fixed inset-0 top-16 bg-black transform translate-x-full transition-transform duration-300 ease-in-out"
  >
    <div class="container py-6 space-y-1">
      {navItems.map((item) => (
        <a
          href={item.href}
          class:list={[
            'block px-4 py-3 rounded-lg text-base font-medium transition-colors text-white',
            currentPath === item.href
              ? 'bg-primary/20 text-primary'
              : 'hover:bg-white/10'
          ]}
        >
          {item.label}
        </a>
      ))}

      <!-- Mobile CTA Button -->
      <div class="mt-6 mx-4">
        <a
          href="https://wa.me/6285398989810?text=Halo%20SJD%20Interior%2C%20saya%20ingin%20berkonsultasi%20tentang%20proyek%20interior%20saya."
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center w-full px-6 py-2.5 text-[15px] font-medium bg-[#0096f7] text-white rounded-full hover:bg-[#0085e0] transition-colors"
        >
          Konsultasi
        </a>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer removed - all pages now have transparent header at top -->

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  let isMenuOpen = false;

  menuButton?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      mobileMenu?.classList.remove('translate-x-full');
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    } else {
      mobileMenu?.classList.add('translate-x-full');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      document.body.style.overflow = '';
    }
  });

  // Close mobile menu when clicking on a link
  const mobileLinks = mobileMenu?.querySelectorAll('a');
  mobileLinks?.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('translate-x-full');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      document.body.style.overflow = '';
      isMenuOpen = false;
    });
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) {
      mobileMenu?.classList.add('translate-x-full');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      document.body.style.overflow = '';
      isMenuOpen = false;
    }
  });

  // Smart header background detection
  const header = document.getElementById('main-header');

  if (header) {
    // Function to check and update header
    const initializeHeader = () => {
      // Check if page has a hero section (image/banner at top)
      // Only look for explicit hero markers, not all sections
      const hasHeroSection = document.querySelector('[data-hero-section]');
      const shouldBeTransparent = !!hasHeroSection;

      const updateHeader = () => {
        const scrollY = window.scrollY;

        if (shouldBeTransparent) {
          // Page has hero - use transparent mode at top
          if (scrollY > 100) {
            header.classList.add('bg-white', 'shadow-sm');
            header.classList.remove('bg-transparent', 'bg-black/90');
          } else {
            header.classList.add('bg-transparent');
            header.classList.remove('bg-white', 'shadow-sm', 'bg-black/90');
          }
        } else {
          // No hero - always use white background
          header.classList.add('bg-white', 'shadow-sm');
          header.classList.remove('bg-transparent', 'bg-black/90');
        }
      };

      // Initial check
      updateHeader();

      // Listen to scroll events
      window.addEventListener('scroll', updateHeader, { passive: true });
    };

    // Run immediately and also after DOM is fully loaded
    initializeHeader();

    // Ensure it runs after all components are mounted
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeHeader);
    }
  }
</script>

<style>
  /* Ensure smooth mobile menu animation */
  #mobile-menu {
    will-change: transform;
  }

  /* Header transitions */
  #main-header {
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  .header-logo,
  .header-link,
  .header-menu-btn {
    transition: color 0.3s ease;
  }

  /* Default state (Transparent background, White text) */
  #main-header.bg-transparent .header-logo,
  #main-header.bg-transparent .header-link,
  #main-header.bg-transparent .header-menu-btn {
    color: white;
  }

  #main-header.bg-transparent .header-link:hover {
    color: var(--color-primary, #0066ff);
  }

  /* Scrolled state (White background, Dark text) */
  #main-header.bg-white .header-logo,
  #main-header.bg-white .header-link,
  #main-header.bg-white .header-menu-btn {
    color: #1a1a1a;
  }

  #main-header.bg-white .header-link:hover {
    opacity: 0.7;
  }
  
  /* White button on transparent header */
  #main-header.bg-transparent .header-cta-btn {
    background-color: #ffffff;
    color: #000000;
  }
  
  /* Black button on scrolled header */
  #main-header.bg-white .header-cta-btn {
    background-color: #000000;
    color: #ffffff;
  }

  /* Logo switching based on header background */
  /* Both logos have identical dimensions to prevent layout shift */
  .logo-dark,
  .logo-light {
    transition: opacity 0.3s ease;
  }

  /* Default state (transparent background) - show light logo */
  #main-header.bg-transparent .logo-dark {
    opacity: 0;
    pointer-events: none;
  }

  #main-header.bg-transparent .logo-light {
    opacity: 1;
    pointer-events: auto;
  }

  /* Scrolled state (white background) - show dark logo */
  #main-header.bg-white .logo-dark {
    opacity: 1;
    pointer-events: auto;
  }

  #main-header.bg-white .logo-light {
    opacity: 0;
    pointer-events: none;
  }

  /* Fallback if only one logo exists */
  .header-logo-link:has(.logo-dark:only-child) .logo-dark,
  .header-logo-link:has(.logo-light:only-child) .logo-light {
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  /* Ensure logos are positioned identically */
  .header-logo-link {
    display: inline-block;
  }

  .logo-dark.absolute {
    position: absolute;
  }
</style>
