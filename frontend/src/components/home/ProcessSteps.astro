---
// Process steps section
const steps = [
  {
    number: '01',
    title: 'Konsultasi',
    description: 'Ceritakan kebutuhan dan gaya yang Anda inginkan. Kami dengarkan, kami pahami.',
    image: '/images/process-step-1.jpg'
  },
  {
    number: '02',
    title: 'Desain',
    description: 'Tim kami membuat konsep dan visualisasi 3D. Revisi sampai Anda puas.',
    image: '/images/process-step-2.jpg'
  },
  {
    number: '03',
    title: 'Produksi',
    description: 'Kami produksi furniture dan siapkan material. Anda tinggal menunggu.',
    image: '/images/process-step-3.jpg'
  },
  {
    number: '04',
    title: 'Serah terima',
    description: 'Instalasi selesai, quality check done. Interior impian Anda siap dinikmati.',
    image: '/images/process-step-4.jpg'
  },
];
---

<section class="py-16 md:py-24 bg-white" data-process-section>
  <!-- Gallery Section Image -->
  <div class="mb-16 md:mb-24" data-gallery-wrapper>
    <img 
      src="/images/gallery-section.svg" 
      alt="Interior gallery" 
      class="w-full h-auto object-cover"
      data-gallery-image
    />
  </div>

  <div class="container mx-auto max-w-[1440px] px-4 md:px-8">
    <!-- Section Heading -->
    <div class="text-center mb-8 md:mb-12 lg:mb-16 px-4" data-process-heading>
      <h2 
        class="text-[clamp(1.75rem,4.5vw,53.13px)] font-light text-black mb-2 leading-tight" 
        style="letter-spacing: clamp(-2px, -0.05em, -2.66px);"
        data-process-title
      >
        Dapatkan interior impian dalam empat langkah.
      </h2>
      <p 
        class="text-[clamp(1.75rem,4.5vw,53.13px)] font-light text-[#a7a7a7] leading-tight" 
        style="letter-spacing: clamp(-2px, -0.05em, -2.66px);"
        data-process-subtitle
      >
        Secepat 4-8 minggu pengerjaan.
      </p>
    </div>

    <!-- Stepper Navigation - Responsive -->
    <div class="mb-12 md:mb-16 overflow-x-auto scrollbar-hide" data-stepper-wrapper>
      <div class="flex items-center justify-start md:justify-center min-w-max px-4 mx-auto">
        {steps.map((step, index) => (
          <>
            <!-- Step Box -->
            <div 
              class:list={[
                'flex items-center justify-center rounded-[13px] transition-all flex-shrink-0',
                'w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20',
                index % 2 === 0 
                  ? 'bg-black text-white' 
                  : 'bg-white border border-[#767676] md:border-2 text-[#626262]'
              ]}
              data-step-box
              data-step-index={index}
            >
              <span class="text-[18px] sm:text-[20px] md:text-[24px] font-light" style="letter-spacing: -1.2px;">
                {step.number}
              </span>
            </div>
            
            <!-- Connecting Line -->
            {index < steps.length - 1 && (
              <div 
                class="w-16 sm:w-24 md:w-32 lg:w-48 h-px bg-[#dfdfdf] mx-1 sm:mx-2 flex-shrink-0" 
                data-step-line
                data-line-index={index}
              ></div>
            )}
          </>
        ))}
      </div>
    </div>

    <!-- Process Steps Content - Responsive Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 lg:gap-12 mb-12 md:mb-16" data-steps-grid>
      {steps.map((step, index) => (
        <div class="relative" data-step-content data-content-index={index}>
          <!-- Step Title -->
          <h3 
            class="text-[clamp(1.5rem,4vw,32px)] font-light text-black mb-2 md:mb-3" 
            style="letter-spacing: -1.6px;"
            data-step-title
          >
            {step.title}
          </h3>

          <!-- Step Description -->
          <p 
            class="text-[clamp(1rem,2.5vw,20px)] font-normal text-[#929292] leading-relaxed mb-4 md:mb-6" 
            style="letter-spacing: -0.5px;"
            data-step-description
          >
            {step.description}
          </p>

          <!-- Step Image -->
          <img 
            src={step.image} 
            alt={step.title} 
            class="w-full h-auto aspect-[2/3] object-cover rounded-[16px] md:rounded-[24px]"
            data-step-image
          />
        </div>
      ))}
    </div>

    <!-- CTA Section -->
    <div class="text-center" data-process-cta>
      <h3 class="text-[clamp(2rem,4vw,46.21px)] font-light text-black mb-2" style="letter-spacing: -2.31px;" data-cta-title>
        Mau tahu lebih detail?
      </h3>
      <p class="text-[clamp(2rem,4vw,46.21px)] font-light text-[#919191] mb-8" style="letter-spacing: -2.31px;" data-cta-subtitle>
        Pelajari proses kerja kami dari awal sampai akhir.
      </p>
      <div class="flex flex-wrap items-center justify-center gap-6" data-cta-buttons>
        <a 
          href="/workflow" 
          class="text-[21.41px] font-medium text-[#0096f7] hover:opacity-70 transition-opacity"
        >
          Cara Kerja
        </a>
        <a 
          href="/contact" 
          class="text-[21.41px] font-medium text-black hover:opacity-70 transition-opacity"
        >
          Konsultasi
        </a>
      </div>
    </div>
  </div>
</section>

<!-- ProcessSteps Timeline Animations -->
<script>
  import { createReveal, createScaleAnimation, gsap } from '../../utils/gsap';

  const initProcessAnimations = () => {
    const processSection = document.querySelector('[data-process-section]');
    if (!processSection) return;

    // Gallery image reveal with scale
    const galleryImage = document.querySelector('[data-gallery-image]');
    if (galleryImage) {
      gsap.fromTo(
        galleryImage,
        { opacity: 0, scale: 1.1 },
        {
          opacity: 1,
          scale: 1,
          duration: 1.5,
          ease: 'power3.out',
          scrollTrigger: {
            trigger: galleryImage,
            start: 'top 80%',
            once: true,
          },
        }
      );
    }

    // Process heading reveal
    const processTitle = document.querySelector('[data-process-title]');
    const processSubtitle = document.querySelector('[data-process-subtitle]');

    if (processTitle) {
      createReveal(processTitle as HTMLElement, {
        from: { opacity: 0, y: 60 },
        to: { opacity: 1, y: 0 },
        start: 'top 80%',
        once: true,
      });
    }

    if (processSubtitle) {
      createReveal(processSubtitle as HTMLElement, {
        from: { opacity: 0, y: 60 },
        to: { opacity: 1, y: 0 },
        delay: 0.2,
        start: 'top 80%',
        once: true,
      });
    }

    // Stepper timeline animation - sequential reveal
    const stepBoxes = document.querySelectorAll('[data-step-box]');
    const stepLines = document.querySelectorAll('[data-step-line]');

    // Create a timeline for sequential animations
    const stepperTimeline = gsap.timeline({
      scrollTrigger: {
        trigger: '[data-stepper-wrapper]',
        start: 'top 75%',
        once: true,
      },
    });

    stepBoxes.forEach((box, index) => {
      const line = stepLines[index];

      // Animate step box
      stepperTimeline.fromTo(
        box,
        {
          opacity: 0,
          scale: 0,
          rotation: -180,
        },
        {
          opacity: 1,
          scale: 1,
          rotation: 0,
          duration: 0.5,
          ease: 'back.out(1.7)',
        },
        index * 0.2
      );

      // Animate connecting line (draw effect)
      if (line) {
        stepperTimeline.fromTo(
          line,
          {
            scaleX: 0,
            transformOrigin: 'left center',
          },
          {
            scaleX: 1,
            duration: 0.4,
            ease: 'power2.out',
          },
          index * 0.2 + 0.3
        );
      }
    });

    // Animate process step content cards
    const stepContents = document.querySelectorAll('[data-step-content]');
    stepContents.forEach((content, index) => {
      const contentElement = content as HTMLElement;
      const title = content.querySelector('[data-step-title]');
      const description = content.querySelector('[data-step-description]');
      const image = content.querySelector('[data-step-image]');

      // Card reveal
      gsap.fromTo(
        contentElement,
        {
          opacity: 0,
          y: 100,
        },
        {
          opacity: 1,
          y: 0,
          duration: 1,
          ease: 'power3.out',
          delay: index * 0.15,
          scrollTrigger: {
            trigger: contentElement,
            start: 'top 85%',
            once: true,
          },
        }
      );

      // Title reveal
      if (title) {
        gsap.fromTo(
          title,
          { opacity: 0, x: -30 },
          {
            opacity: 1,
            x: 0,
            duration: 0.8,
            delay: index * 0.15 + 0.3,
            scrollTrigger: {
              trigger: contentElement,
              start: 'top 85%',
              once: true,
            },
          }
        );
      }

      // Description reveal
      if (description) {
        gsap.fromTo(
          description,
          { opacity: 0 },
          {
            opacity: 1,
            duration: 0.8,
            delay: index * 0.15 + 0.5,
            scrollTrigger: {
              trigger: contentElement,
              start: 'top 85%',
              once: true,
            },
          }
        );
      }

      // Image scale animation
      if (image) {
        createScaleAnimation(image as HTMLElement, {
          fromScale: 0.9,
          toScale: 1,
          start: 'top 85%',
          end: 'top 40%',
          scrub: 1,
        });
      }
    });

    // CTA section reveal
    const ctaTitle = document.querySelector('[data-cta-title]');
    const ctaSubtitle = document.querySelector('[data-cta-subtitle]');
    const ctaButtons = document.querySelector('[data-cta-buttons]');

    if (ctaTitle) {
      createReveal(ctaTitle as HTMLElement, {
        from: { opacity: 0, y: 50 },
        to: { opacity: 1, y: 0 },
        start: 'top 85%',
        once: true,
      });
    }

    if (ctaSubtitle) {
      createReveal(ctaSubtitle as HTMLElement, {
        from: { opacity: 0, y: 50 },
        to: { opacity: 1, y: 0 },
        delay: 0.2,
        start: 'top 85%',
        once: true,
      });
    }

    if (ctaButtons) {
      createReveal(ctaButtons as HTMLElement, {
        from: { opacity: 0, y: 30 },
        to: { opacity: 1, y: 0 },
        delay: 0.4,
        start: 'top 85%',
        once: true,
      });
    }
  };

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initProcessAnimations);
  
  // Re-initialize for Astro view transitions
  document.addEventListener('astro:page-load', initProcessAnimations);
</script>

<style>
  /* Performance optimization */
  [data-step-box],
  [data-step-line],
  [data-step-content],
  [data-gallery-image] {
    will-change: transform, opacity;
  }

  @media (prefers-reduced-motion: reduce) {
    [data-step-box],
    [data-step-line],
    [data-step-content],
    [data-gallery-image] {
      will-change: auto;
      transform: none !important;
    }
  }
</style>