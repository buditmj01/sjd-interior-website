---
// Testimonials section
const testimonials = [
  {
    quote: '"Hasil desainnya melebihi ekspektasi kami"',
    avatar: '/images/avatar-1.svg',
    rating: 5
  },
  {
    quote: '"Hasil desainnya melebihi ekspektasi kami"',
    avatar: '/images/avatar-2.svg',
    rating: 5
  },
  {
    quote: '"Hasil desainnya melebihi ekspektasi kami"',
    avatar: '/images/avatar-3.svg',
    rating: 5
  },
];
---

<section class="py-16 md:py-24 bg-white" data-testimonials-section>
  <div class="container mx-auto max-w-[1440px] px-4 md:px-8">
    <!-- Section Title -->
    <h2 
      class="text-center text-[clamp(1.75rem,3.5vw,43.7px)] font-light text-[#151515] mb-12 md:mb-16" 
      style="letter-spacing: -2.18px;"
      data-testimonials-title
    >
      Apa kata mereka tentang SJD Interior
    </h2>

    <!-- Testimonials Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8" data-testimonials-grid>
      {testimonials.map((testimonial, index) => (
        <div 
          class="bg-white rounded-[22px] p-8 shadow-[0px_2.08px_19.45px_rgba(0,0,0,0.13)]"
          data-testimonial-card
          data-testimonial-index={index}
        >
          <!-- Quote -->
          <p class="text-[28.2px] font-light text-black mb-6" data-testimonial-quote>
            {testimonial.quote}
          </p>
          
          <!-- Avatar and Rating -->
          <div class="flex items-center gap-4" data-testimonial-footer>
            <img 
              src={testimonial.avatar} 
              alt="Customer avatar" 
              class="w-6 h-6 rounded-full bg-[#d9d9d9]"
              data-testimonial-avatar
            />
            <div class="text-[16.4px] font-light text-black" data-testimonial-rating>
              ⭐⭐⭐⭐⭐
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<!-- Testimonials Parallax Animations -->
<script>
  import { createReveal, createParallax, gsap } from '../../utils/gsap';

  const initTestimonialsAnimations = () => {
    const testimonialsSection = document.querySelector('[data-testimonials-section]');
    if (!testimonialsSection) return;

    // Reveal title
    const testimonialsTitle = document.querySelector('[data-testimonials-title]');
    if (testimonialsTitle) {
      createReveal(testimonialsTitle as HTMLElement, {
        from: { opacity: 0, y: 60 },
        to: { opacity: 1, y: 0 },
        start: 'top 80%',
        once: true,
      });
    }

    // Animate testimonial cards with parallax and reveal
    const testimonialCards = document.querySelectorAll('[data-testimonial-card]');
    testimonialCards.forEach((card, index) => {
      const cardElement = card as HTMLElement;
      const quote = card.querySelector('[data-testimonial-quote]');
      const footer = card.querySelector('[data-testimonial-footer]');

      // Card reveal with stagger and rotation
      gsap.fromTo(
        cardElement,
        {
          opacity: 0,
          y: 80,
          rotationX: 15,
          scale: 0.9,
        },
        {
          opacity: 1,
          y: 0,
          rotationX: 0,
          scale: 1,
          duration: 1,
          ease: 'power3.out',
          delay: index * 0.15,
          scrollTrigger: {
            trigger: cardElement,
            start: 'top 85%',
            once: true,
          },
        }
      );

      // Parallax effect - different speed for each card (layered depth)
      const speeds = [0.3, 0.5, 0.4]; // Varying speeds for visual interest
      const speed = speeds[index % speeds.length];

      createParallax(cardElement, {
        speed: speed,
        direction: 'vertical',
        start: 'top bottom',
        end: 'bottom top',
      });

      // Quote fade-in
      if (quote) {
        gsap.fromTo(
          quote,
          { opacity: 0 },
          {
            opacity: 1,
            duration: 0.8,
            delay: index * 0.15 + 0.3,
            scrollTrigger: {
              trigger: cardElement,
              start: 'top 85%',
              once: true,
            },
          }
        );
      }

      // Footer slide up
      if (footer) {
        gsap.fromTo(
          footer,
          { opacity: 0, y: 20 },
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            delay: index * 0.15 + 0.5,
            scrollTrigger: {
              trigger: cardElement,
              start: 'top 85%',
              once: true,
            },
          }
        );
      }

      // Hover effect - slight tilt
      cardElement.addEventListener('mouseenter', () => {
        gsap.to(cardElement, {
          rotationY: 5,
          rotationX: -3,
          scale: 1.02,
          duration: 0.3,
          ease: 'power2.out',
        });
      });

      cardElement.addEventListener('mouseleave', () => {
        gsap.to(cardElement, {
          rotationY: 0,
          rotationX: 0,
          scale: 1,
          duration: 0.3,
          ease: 'power2.out',
        });
      });
    });
  };

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initTestimonialsAnimations);
  
  // Re-initialize for Astro view transitions
  document.addEventListener('astro:page-load', initTestimonialsAnimations);
</script>

<style>
  /* Performance optimization */
  [data-testimonial-card] {
    will-change: transform, opacity;
    perspective: 1000px;
    transform-style: preserve-3d;
  }

  @media (prefers-reduced-motion: reduce) {
    [data-testimonial-card] {
      will-change: auto;
      transform: none !important;
      perspective: none;
    }
  }
</style>